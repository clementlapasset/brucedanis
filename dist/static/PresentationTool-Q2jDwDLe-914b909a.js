import{aw as an,r as a,ax as st,ay as cn,p as un,aj as ln,j as s,az as Ye,u as te,aA as at,aB as Mt,ac as G,aC as dn,aD as ct,aE as pn,a3 as de,aF as je,a7 as N,aG as se,aH as hn,k as ae,aI as fn,aJ as mn,aK as ut,aL as yn,aM as lt,aN as vn,aO as Re,a6 as me,aP as dt,aQ as gn,aR as wn,aS as bn,aT as ze,a8 as Oe,aU as pt,aV as xn,G as jn,aW as _e,aX as Ge,aY as Sn,aZ as kn,t as Ut,a_ as Tt,a$ as Pn,b0 as En,b1 as Ve,b2 as In,a4 as An,b3 as Cn,b4 as $t,b5 as Rn,b6 as zn,b7 as On,b8 as Dt,b9 as _n,ba as Mn,bb as Un,bc as Tn,bd as $n,be as qe,T as Lt,ar as Ft,Q as Vt,a as Dn,e as Ln,D as Fn,bf as Vn,bg as Nn,Z as Bn}from"./sanity-d7efbd2a.js";import{T as Wn,c as Kn}from"./DisplayedDocumentBroadcaster-VVQiO-FG-3728973c.js";function Gn({children:n,isValidProp:e,...t}){e&&an(e),t={...a.useContext(st),...t},t.isStatic=cn(()=>t.isStatic);const i=a.useMemo(()=>t,[JSON.stringify(t.transition),t.transformPagePoint,t.reducedMotion]);return a.createElement(st.Provider,{value:i},n)}const qn=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,He=/_key\s*==\s*['"](.*)['"]/,Jn=/^\d*:\d*$/;function Qe(n){return typeof n=="number"||typeof n=="string"&&/^\[\d+\]$/.test(n)}function Te(n){return typeof n=="string"?He.test(n.trim()):typeof n=="object"&&"_key"in n}function Nt(n){if(typeof n=="string"&&Jn.test(n))return!0;if(!Array.isArray(n)||n.length!==2)return!1;const[e,t]=n;return(typeof e=="number"||e==="")&&(typeof t=="number"||t==="")}function Bt(n,e,t){const i=typeof e=="string"?Kt(e):e;if(!Array.isArray(i))throw new Error("Path must be an array or a string");let r=n;for(let o=0;o<i.length;o++){const u=i[o];if(Qe(u)){if(!Array.isArray(r))return t;r=r[u]}if(Te(u)){if(!Array.isArray(r))return t;r=r.find(p=>p._key===u._key)}if(typeof u=="string"&&(r=typeof r=="object"&&r!==null?r[u]:void 0),typeof r>"u")return t}return r}function Wt(n){if(!Array.isArray(n))throw new Error("Path is not an array");return n.reduce((e,t,i)=>{const r=typeof t;if(r==="number")return"".concat(e,"[").concat(t,"]");if(r==="string"){const o=i===0?"":".";return"".concat(e).concat(o).concat(t)}if(Te(t)&&t._key)return"".concat(e,'[_key=="').concat(t._key,'"]');if(Array.isArray(t)){const[o,u]=t;return"".concat(e,"[").concat(o,":").concat(u,"]")}throw new Error("Unsupported path segment `".concat(JSON.stringify(t),"`"))},"")}function Kt(n){if(typeof n!="string")throw new Error("Path is not a string");const e=n.match(qn);if(!e)throw new Error("Invalid path string");return e.map(Xn)}function Xn(n){return Qe(n)?Yn(n):Te(n)?Hn(n):Nt(n)?Qn(n):n}function Yn(n){return Number(n.replace(/[^\d]/g,""))}function Hn(n){return{_key:n.match(He)[1]}}function Qn(n){const[e,t]=n.split(":").map(i=>i===""?i:Number(i));return[e,t]}var Gt=Object.freeze({__proto__:null,fromString:Kt,get:Bt,isIndexSegment:Qe,isIndexTuple:Nt,isKeySegment:Te,reKeySegment:He,toString:Wt});const Se="drafts.";function Me(n){return n.startsWith(Se)?n.slice(Se.length):n}const ht={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},ft={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function Zn(n){return"$".concat(n.map(e=>{if(typeof e=="string"){const t=e.replace(/[\f\n\r\t'\\]/g,i=>ht[i]);return"['".concat(t,"']")}if(typeof e=="number")return"[".concat(e,"]");if(e._key!==""){const t=e._key.replace(/['\\]/g,i=>ht[i]);return"[?(@._key=='".concat(t,"')]")}return"[".concat(e._index,"]")}).join(""))}function er(n){const e=[],t=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let i;for(;(i=t.exec(n))!==null;){if(i[1]!==void 0){const r=i[1].replace(/\\(\\|f|n|r|t|')/g,o=>ft[o]);e.push(r);continue}if(i[2]!==void 0){e.push(parseInt(i[2],10));continue}if(i[3]!==void 0){const r=i[3].replace(/\\(\\')/g,o=>ft[o]);e.push({_key:r,_index:-1});continue}}return e}function tr(n){return n.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._index!==-1)return e._index;throw new Error("invalid segment:".concat(JSON.stringify(e)))})}function nr(n,e){if(!(e!=null&&e.mappings))return;const t=Zn(tr(n));if(e.mappings[t]!==void 0)return{mapping:e.mappings[t],matchedPath:t,pathSuffix:""};const i=Object.entries(e.mappings).filter(([p])=>t.startsWith(p)).sort(([p],[l])=>l.length-p.length);if(i.length==0)return;const[r,o]=i[0],u=t.substring(r.length);return{mapping:o,matchedPath:r,pathSuffix:u}}function rr(n){return n!==null&&Array.isArray(n)}function mt(n){return typeof n=="object"&&n!==null}function Ae(n,e,t=[]){return rr(n)?n.map((i,r)=>{if(mt(i)){const o=i._key;if(typeof o=="string")return Ae(i,e,t.concat({_key:o,_index:r}))}return Ae(i,e,t.concat(r))}):mt(n)?Object.fromEntries(Object.entries(n).map(([i,r])=>[i,Ae(r,e,t.concat(i))])):e(n,t)}const ir=n=>n;function or(n,e,t,i=ir,r="raw"){if(!e)return n;if(r!=="published"&&r!=="raw"&&r!=="previewDrafts")throw new Error('Unknown perspective "'.concat(r,'"'));return Ae(JSON.parse(JSON.stringify(n)),(o,u)=>{const p=nr(u,e);if(!p)return o;const{mapping:l,pathSuffix:h}=p;if(l.type!=="value"||l.source.type!=="documentValue")return o;const f=e.documents[l.source.document],c=e.paths[l.source.path];if(f){const d=er(c+h),m=Wt(d);if(m==="_id")return o;let y;if(r==="previewDrafts"?(y=t(f._id.startsWith(Se)?f:{...f,_id:"".concat(Se,".").concat(f._id,"}")}),y||(y=t(f._id.startsWith(Se)?{...f,_id:Me(f._id)}:f)),y&&(y={...y,_id:Me(f._id),_originalId:f._id})):y=t(f),!y)return o;const w=y?Bt(y,m,o):o;return o===w?o:i(w,{cachedDocument:y,previousValue:o,sourceDocument:f,sourcePath:d})}return o})}var sr=Object.defineProperty,ar=(n,e,t)=>e in n?sr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,we=(n,e,t)=>(ar(n,typeof e!="symbol"?e+"":e,t),t);const cr=["Value","Copy","Blank","ReturnIntoArray","ReturnIntoObject","ReturnIntoObjectSameKey","PushField","PushElement","PushParent","Pop","PushFieldCopy","PushFieldBlank","PushElementCopy","PushElementBlank","ReturnIntoObjectPop","ReturnIntoObjectSameKeyPop","ReturnIntoArrayPop","ObjectSetFieldValue","ObjectCopyField","ObjectDeleteField","ArrayAppendValue","ArrayAppendSlice","StringAppendString","StringAppendSlice"];class ur{constructor(e,t,i){we(this,"model"),we(this,"root"),we(this,"patch"),we(this,"i"),we(this,"inputStack"),we(this,"outputStack"),this.model=e,this.root=t,this.patch=i,this.i=0,this.inputStack=[],this.outputStack=[]}read(){return this.patch[this.i++]}process(){for(this.inputStack.push({value:this.root}),this.outputStack.push({value:this.root});this.i<this.patch.length;){let t=this.read(),i=cr[t];if(!i)throw new Error("Unknown opcode: ".concat(t));let r="process".concat(i);this[r].apply(this)}let e=this.outputStack.pop();return this.finalizeOutput(e)}inputEntry(){return this.inputStack[this.inputStack.length-1]}inputKey(e,t){return e.keys||(e.keys=this.model.objectGetKeys(e.value).sort()),e.keys[t]}outputEntry(){return this.outputStack[this.outputStack.length-1]}outputArray(){let e=this.outputEntry();return e.writeValue||(e.writeValue=this.model.copyArray(e.value)),e.writeValue}outputObject(){let e=this.outputEntry();return e.writeValue||(e.writeValue=this.model.copyObject(e.value)),e.writeValue}outputString(){let e=this.outputEntry();return e.writeValue||(e.writeValue=this.model.copyString(e.value)),e.writeValue}finalizeOutput(e){return e.writeValue?this.model.finalize(e.writeValue):e.value}processValue(){let e=this.model.wrap(this.read());this.outputStack.push({value:e})}processCopy(){let e=this.inputEntry();this.outputStack.push({value:e.value})}processBlank(){this.outputStack.push({value:null})}processReturnIntoArray(){let e=this.outputStack.pop(),t=this.finalizeOutput(e),i=this.outputArray();this.model.arrayAppendValue(i,t)}processReturnIntoObject(){let e=this.read(),t=this.outputStack.pop(),i=this.finalizeOutput(t);i=this.model.markChanged(i);let r=this.outputObject();this.model.objectSetField(r,e,i)}processReturnIntoObjectSameKey(){let e=this.inputEntry(),t=this.outputStack.pop(),i=this.finalizeOutput(t),r=this.outputObject();this.model.objectSetField(r,e.key,i)}processPushField(){let e=this.read(),t=this.inputEntry(),i=this.inputKey(t,e),r=this.model.objectGetField(t.value,i);this.inputStack.push({value:r,key:i})}processPushElement(){let e=this.read(),t=this.inputEntry(),i=this.model.arrayGetElement(t.value,e);this.inputStack.push({value:i})}processPop(){this.inputStack.pop()}processPushFieldCopy(){this.processPushField(),this.processCopy()}processPushFieldBlank(){this.processPushField(),this.processBlank()}processPushElementCopy(){this.processPushElement(),this.processCopy()}processPushElementBlank(){this.processPushElement(),this.processBlank()}processReturnIntoObjectPop(){this.processReturnIntoObject(),this.processPop()}processReturnIntoObjectSameKeyPop(){this.processReturnIntoObjectSameKey(),this.processPop()}processReturnIntoArrayPop(){this.processReturnIntoArray(),this.processPop()}processObjectSetFieldValue(){this.processValue(),this.processReturnIntoObject()}processObjectCopyField(){this.processPushField(),this.processCopy(),this.processReturnIntoObjectSameKey(),this.processPop()}processObjectDeleteField(){let e=this.read(),t=this.inputEntry(),i=this.inputKey(t,e),r=this.outputObject();this.model.objectDeleteField(r,i)}processArrayAppendValue(){let e=this.model.wrap(this.read()),t=this.outputArray();this.model.arrayAppendValue(t,e)}processArrayAppendSlice(){let e=this.read(),t=this.read(),i=this.outputArray(),r=this.inputEntry().value;this.model.arrayAppendSlice(i,r,e,t)}processStringAppendString(){let e=this.model.wrap(this.read()),t=this.outputString();this.model.stringAppendValue(t,e)}processStringAppendSlice(){let e=this.read(),t=this.read(),i=this.outputString(),r=this.inputEntry().value;this.model.stringAppendSlice(i,r,e,t)}}function lr(n){return n>>16?4:n>>11?3:n>>7?2:1}function yt(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=t,r=0;for(r=t;i<e;r++){let o=n.codePointAt(r),u=lr(o);u===4&&r++,i+=u}return r}class dr{wrap(e){return e}finalize(e){return Array.isArray(e)?e:e.data}markChanged(e){return e}objectGetKeys(e){return Object.keys(e)}objectGetField(e,t){return e[t]}arrayGetElement(e,t){return e[t]}copyObject(e){let t={type:"object",data:{}};if(e!==null)for(let[i,r]of Object.entries(e))t.data[i]=r;return t}copyArray(e){return e===null?[]:e.slice()}copyString(e){return{type:"string",data:e===null?"":e}}objectSetField(e,t,i){e.data[t]=i}objectDeleteField(e,t){delete e.data[t]}arrayAppendValue(e,t){e.push(t)}arrayAppendSlice(e,t,i,r){e.push(...t.slice(i,r))}stringAppendSlice(e,t,i,r){const o=t,u=yt(o,i),p=yt(o,r,u);e.data+=o.slice(u,p)}stringAppendValue(e,t){e.data+=t}}function pr(n,e){let t=n;return new ur(new dr,t,e).process()}function ce(n){if(typeof n!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=n}typeof Symbol<"u"&&(ce.prototype[Symbol.iterator]=function(){return this});ce.of=function(){var n=arguments,e=n.length,t=0;return new ce(function(){return t>=e?{done:!0}:{done:!1,value:n[t++]}})};ce.empty=function(){var n=new ce(function(){return{done:!0}});return n};ce.fromSequence=function(n){var e=0,t=n.length;return new ce(function(){return e>=t?{done:!0}:{done:!1,value:n[e++]}})};ce.is=function(n){return n instanceof ce?!0:typeof n=="object"&&n!==null&&typeof n.next=="function"};var hr=ce,Ze={};Ze.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";Ze.SYMBOL_SUPPORT=typeof Symbol<"u";var qt=Ze,fr=qt.ARRAY_BUFFER_SUPPORT,mr=qt.SYMBOL_SUPPORT,et=function(e,t){var i,r,o,u,p;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if(typeof t!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||fr&&ArrayBuffer.isView(e)||typeof e=="string"||e.toString()==="[object Arguments]"){for(o=0,u=e.length;o<u;o++)t(e[o],o);return}if(typeof e.forEach=="function"){e.forEach(t);return}if(mr&&Symbol.iterator in e&&typeof e.next!="function"&&(e=e[Symbol.iterator]()),typeof e.next=="function"){for(i=e,o=0;p=i.next(),p.done!==!0;)t(p.value,o),o++;return}for(r in e)e.hasOwnProperty(r)&&t(e[r],r)},$e={};(function(n){var e=Math.pow(2,8)-1,t=Math.pow(2,16)-1,i=Math.pow(2,32)-1,r=Math.pow(2,7)-1,o=Math.pow(2,15)-1,u=Math.pow(2,31)-1;n.getPointerArray=function(l){var h=l-1;if(h<=e)return Uint8Array;if(h<=t)return Uint16Array;if(h<=i)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},n.getSignedPointerArray=function(l){var h=l-1;return h<=r?Int8Array:h<=o?Int16Array:h<=u?Int32Array:Float64Array},n.getNumberType=function(l){return l===(l|0)?Math.sign(l)===-1?l<=127&&l>=-128?Int8Array:l<=32767&&l>=-32768?Int16Array:Int32Array:l<=255?Uint8Array:l<=65535?Uint16Array:Uint32Array:Float64Array};var p={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};n.getMinimalRepresentation=function(l,h){var f=null,c=0,d,m,y,w,v;for(w=0,v=l.length;w<v;w++)y=h?h(l[w]):l[w],m=n.getNumberType(y),d=p[m.name],d>c&&(c=d,f=m);return f},n.isTypedArray=function(l){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(l)},n.concat=function(){var l=0,h,f,c;for(h=0,c=arguments.length;h<c;h++)l+=arguments[h].length;var d=new arguments[0].constructor(l);for(h=0,f=0;h<c;h++)d.set(arguments[h],f),f+=arguments[h].length;return d},n.indices=function(l){for(var h=n.getPointerArray(l),f=new h(l),c=0;c<l;c++)f[c]=c;return f}})($e);var xe={},Jt=et,Xt=$e;function yr(n){return Array.isArray(n)||Xt.isTypedArray(n)}function tt(n){if(typeof n.length=="number")return n.length;if(typeof n.size=="number")return n.size}function vr(n){var e=tt(n),t=typeof e=="number"?new Array(e):[],i=0;return Jt(n,function(r){t[i++]=r}),t}function gr(n){var e=tt(n),t=typeof e=="number"?Xt.getPointerArray(e):Array,i=typeof e=="number"?new Array(e):[],r=typeof e=="number"?new t(e):[],o=0;return Jt(n,function(u){i[o]=u,r[o]=o++}),[i,r]}xe.isArrayLike=yr;xe.guessLength=tt;xe.toArray=vr;xe.toArrayWithIndices=gr;var nt=hr,wr=et,br=$e,xr=xe;function M(n,e,t){if(arguments.length<2&&(t=n,n=null,e=null),this.capacity=t,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var i=br.getPointerArray(t);this.forward=new i(t),this.backward=new i(t),this.K=typeof n=="function"?new n(t):new Array(t),this.V=typeof e=="function"?new e(t):new Array(t),this.size=0,this.head=0,this.tail=0,this.items={}}M.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};M.prototype.splayOnTop=function(n){var e=this.head;if(this.head===n)return this;var t=this.backward[n],i=this.forward[n];return this.tail===n?this.tail=t:this.backward[i]=t,this.forward[t]=i,this.backward[e]=n,this.head=n,this.forward[n]=e,this};M.prototype.set=function(n,e){var t=this.items[n];if(typeof t<"u"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?t=this.size++:(t=this.tail,this.tail=this.backward[t],delete this.items[this.K[t]]),this.items[n]=t,this.K[t]=n,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};M.prototype.setpop=function(n,e){var t=null,i=null,r=this.items[n];return typeof r<"u"?(this.splayOnTop(r),t=this.V[r],this.V[r]=e,{evicted:!1,key:n,value:t}):(this.size<this.capacity?r=this.size++:(r=this.tail,this.tail=this.backward[r],t=this.V[r],i=this.K[r],delete this.items[i]),this.items[n]=r,this.K[r]=n,this.V[r]=e,this.forward[r]=this.head,this.backward[this.head]=r,this.head=r,i?{evicted:!0,key:i,value:t}:null)};M.prototype.has=function(n){return n in this.items};M.prototype.get=function(n){var e=this.items[n];if(!(typeof e>"u"))return this.splayOnTop(e),this.V[e]};M.prototype.peek=function(n){var e=this.items[n];if(!(typeof e>"u"))return this.V[e]};M.prototype.forEach=function(n,e){e=arguments.length>1?e:this;for(var t=0,i=this.size,r=this.head,o=this.K,u=this.V,p=this.forward;t<i;)n.call(e,u[r],o[r],this),r=p[r],t++};M.prototype.keys=function(){var n=0,e=this.size,t=this.head,i=this.K,r=this.forward;return new nt(function(){if(n>=e)return{done:!0};var o=i[t];return n++,n<e&&(t=r[t]),{done:!1,value:o}})};M.prototype.values=function(){var n=0,e=this.size,t=this.head,i=this.V,r=this.forward;return new nt(function(){if(n>=e)return{done:!0};var o=i[t];return n++,n<e&&(t=r[t]),{done:!1,value:o}})};M.prototype.entries=function(){var n=0,e=this.size,t=this.head,i=this.K,r=this.V,o=this.forward;return new nt(function(){if(n>=e)return{done:!0};var u=i[t],p=r[t];return n++,n<e&&(t=o[t]),{done:!1,value:[u,p]}})};typeof Symbol<"u"&&(M.prototype[Symbol.iterator]=M.prototype.entries);M.prototype.inspect=function(){for(var n=new Map,e=this.entries(),t;t=e.next(),!t.done;)n.set(t.value[0],t.value[1]);return Object.defineProperty(n,"constructor",{value:M,enumerable:!1}),n};typeof Symbol<"u"&&(M.prototype[Symbol.for("nodejs.util.inspect.custom")]=M.prototype.inspect);M.from=function(n,e,t,i){if(arguments.length<2){if(i=xr.guessLength(n),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=e,e=null,t=null);var r=new M(e,t,i);return wr(n,function(o,u){r.set(u,o)}),r};var jr=M,be=jr,Sr=et,kr=$e,Pr=xe;function ue(n,e,t){arguments.length<2?be.call(this,n):be.call(this,n,e,t);var i=kr.getPointerArray(this.capacity);this.deleted=new i(this.capacity),this.deletedSize=0}for(var vt in be.prototype)ue.prototype[vt]=be.prototype[vt];typeof Symbol<"u"&&(ue.prototype[Symbol.iterator]=be.prototype[Symbol.iterator]);ue.prototype.clear=function(){be.prototype.clear.call(this),this.deletedSize=0};ue.prototype.set=function(n,e){var t=this.items[n];if(typeof t<"u"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?(this.deletedSize>0?t=this.deleted[--this.deletedSize]:t=this.size,this.size++):(t=this.tail,this.tail=this.backward[t],delete this.items[this.K[t]]),this.items[n]=t,this.K[t]=n,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};ue.prototype.setpop=function(n,e){var t=null,i=null,r=this.items[n];return typeof r<"u"?(this.splayOnTop(r),t=this.V[r],this.V[r]=e,{evicted:!1,key:n,value:t}):(this.size<this.capacity?(this.deletedSize>0?r=this.deleted[--this.deletedSize]:r=this.size,this.size++):(r=this.tail,this.tail=this.backward[r],t=this.V[r],i=this.K[r],delete this.items[i]),this.items[n]=r,this.K[r]=n,this.V[r]=e,this.forward[r]=this.head,this.backward[this.head]=r,this.head=r,i?{evicted:!0,key:i,value:t}:null)};ue.prototype.delete=function(n){var e=this.items[n];if(typeof e>"u")return!1;if(delete this.items[n],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,!0;var t=this.backward[e],i=this.forward[e];return this.head===e&&(this.head=i),this.tail===e&&(this.tail=t),this.forward[t]=i,this.backward[i]=t,this.size--,this.deleted[this.deletedSize++]=e,!0};ue.prototype.remove=function(n,e=void 0){var t=this.items[n];if(typeof t>"u")return e;var i=this.V[t];if(delete this.items[n],this.size===1)return this.size=0,this.head=0,this.tail=0,this.deletedSize=0,i;var r=this.backward[t],o=this.forward[t];return this.head===t&&(this.head=o),this.tail===t&&(this.tail=r),this.forward[r]=o,this.backward[o]=r,this.size--,this.deleted[this.deletedSize++]=t,i};ue.from=function(n,e,t,i){if(arguments.length<2){if(i=Pr.guessLength(n),typeof i!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(i=e,e=null,t=null);var r=new ue(e,t,i);return Sr(n,function(o,u){r.set(u,o)}),r};var Er=ue;const Ir=un(Er),Yt="sanity.previewUrlSecret",Ar="sanity-preview-url-secret",Cr="2023-11-09",De="sanity-preview-secret",rt="sanity-preview-pathname",Rr=3600,zr=`*[_type == "${Yt}" && dateTime(_updatedAt) <= dateTime(now()) - 3600]`,Or="sanity.preview-url-secret";async function Ht(n,e,t,i,r=ln()){const o=n.withConfig({apiVersion:Cr});try{const u=new Date(Date.now()+1e3*Rr),p=`${Ar}.${r}`,l=function(){if(typeof crypto<"u"){const f=new Uint8Array(16);crypto.getRandomValues(f);let c="";for(let d=0;d<f.length;d++)c+=f[d].toString(16).padStart(2,"0");return c=btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]+$/,""),c}return Math.random().toString(36).slice(2)}(),h=o.patch(p).set({secret:l,source:e,studioUrl:t,userId:i});return await o.transaction().createOrReplace({_id:p,_type:Yt}).patch(h).commit({tag:Or}),{secret:l,expiresAt:u}}finally{await o.delete({query:zr})}}function _r(n){const e=new URL(n);return e.searchParams.delete(rt),e.searchParams.delete(De),e}function Mr(n){return n.searchParams.has(De)}function Ur(n,e,t){const i=new URL(n);return i.searchParams.set(De,e),i.searchParams.set(rt,t),i}function Tr(n){const{draftMode:e,origin:t=typeof location>"u"?"https://localhost":location.origin}=n;let{preview:i="/"}=n;const r=new URL(i,t),o=e.enable?new URL(e.enable,t):void 0;return async u=>{try{if(u.previewSearchParam){const l=new URL(u.previewSearchParam,r);l.origin===r.origin&&(i=`${l.pathname}${l.search}`)}else if(u.referrer){const l=new URL(u.referrer);l.origin===r.origin&&(i=`${l.pathname}${l.search}`)}}catch{}typeof location<"u"&&location.origin===r.origin&&u.studioBasePath&&(i.startsWith(`${u.studioBasePath}/`)||i===u.studioBasePath)&&(i=n.preview||"/");const p=new URL(i,r);if(o){const l=new URL(o),{searchParams:h}=l;return h.set(De,u.previewUrlSecret),p.pathname!==l.pathname&&h.set(rt,`${p.pathname}${p.search}`),l.toString()}return p.toString()}}const $r=n=>typeof n=="object"&&typeof n.then=="function",Ee=[];function Dr(n,e,t=(i,r)=>i===r){if(n===e)return!0;if(!n||!e)return!1;const i=n.length;if(e.length!==i)return!1;for(let r=0;r<i;r++)if(!t(n[r],e[r]))return!1;return!0}function Lr(n,e=null,t=!1,i={}){e===null&&(e=[n]);for(const o of Ee)if(Dr(e,o.keys,o.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return i.lifespan&&i.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,i.lifespan)),o.response;if(!t)throw o.promise}const r={keys:e,equal:i.equal,remove:()=>{const o=Ee.indexOf(r);o!==-1&&Ee.splice(o,1)},promise:($r(n)?n:n(...e)).then(o=>{r.response=o,i.lifespan&&i.lifespan>0&&(r.timeout=setTimeout(r.remove,i.lifespan))}).catch(o=>r.error=o)};if(Ee.push(r),!t)throw r.promise}const gt=(n,e,t)=>Lr(n,e,!1,t);let Ie;const Fr=new Uint8Array(16);function Vr(){if(!Ie&&(Ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ie))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ie(Fr)}const K=[];for(let n=0;n<256;++n)K.push((n+256).toString(16).slice(1));var wt={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ce(n,e,t){if(wt.randomUUID&&!e&&!n)return wt.randomUUID();const i=(n=n||{}).random||(n.rng||Vr)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e){t=t||0;for(let r=0;r<16;++r)e[t+r]=i[r];return e}return function(r,o=0){return K[r[o+0]]+K[r[o+1]]+K[r[o+2]]+K[r[o+3]]+"-"+K[r[o+4]]+K[r[o+5]]+"-"+K[r[o+6]]+K[r[o+7]]+"-"+K[r[o+8]]+K[r[o+9]]+"-"+K[r[o+10]]+K[r[o+11]]+K[r[o+12]]+K[r[o+13]]+K[r[o+14]]+K[r[o+15]]}(i)}const Nr=1e3,Br=1e3,Wr=500,Kr=["handshake/syn","handshake/syn-ack","handshake/ack"],bt=n=>Kr.some(e=>e===n),Gr=({data:n={}})=>typeof n=="object"&&n!==null&&!Array.isArray(n)&&!("domain"in n)&&["id","type","from","to"].every(e=>e in n)&&n.type.startsWith("handshake/");function xt(n){const e=n.target,t=n.connectTo.map(c=>({buffer:[],config:c,id:"",handler:r,status:"connecting",interval:void 0,heartbeat:void 0}));function i(c){window.clearInterval(c.interval)}function r(c){const{data:d}=c;if(bt(d.type)){const m=t.find(y=>y.config.id===d.from);m&&d.type==="handshake/syn-ack"&&(l(m,"connected"),h(m,"handshake/ack",{id:m.id}))}}const o=c=>{var m,y,w;const{data:d}=c;if(!bt(d.type)&&t.find(v=>v.id===d.connectionId)){const v=t.find(g=>g.config.id===d.from);if(v){const g=[d.type,d.data];(y=(m=v.config).onEvent)==null||y.call(m,...g),(w=n.onEvent)==null||w.call(n,...g),f(v,"channel/response",{responseTo:d.id},!1)}}};function u(c){var d;if(Gr(c))console.error(`Visual editing package mismatch detected! Please ensure you are using the latest version of Sanity Studio and any packages listed here:
https://github.com/sanity-io/visual-editing`);else if(function(m){const{data:y,origin:w}=m;return y.domain==="sanity/channels"&&y.to==n.id&&t.map(v=>v.config.id).includes(y.from)&&y.type!=="channel/response"&&w===n.targetOrigin}(c)){const{data:m}=c;(d=t.find(y=>y.config.id===m.from))==null||d.handler(c)}}function p(c){c.heartbeat&&window.clearInterval(c.heartbeat)}function l(c,d){var m,y,w;c.status=d,(y=(m=c.config).onStatusUpdate)==null||y.call(m,d,c.config.id),(w=n.onStatusUpdate)==null||w.call(n,d,c.config.id),d==="connecting"||d==="reconnecting"?(c.handler=r,p(c),function(v){v.id=Ce(),v.interval=window.setInterval(()=>{h(v,"handshake/syn",{id:v.id})},Wr)}(c)):d==="connected"?(c.handler=o,i(c),function(v){if(p(v),v.config.heartbeat){const g=typeof v.config.heartbeat=="number"?v.config.heartbeat:Br;v.heartbeat=window.setInterval(()=>{f(v,"channel/heartbeat")},g)}}(c),function(v){const g=[...v.buffer];v.buffer.splice(0,v.buffer.length),g.forEach(({type:I,data:b})=>{f(v,I,b)})}(c)):d==="disconnected"&&(c.id=null,c.handler=r,i(c),p(c))}function h(c,d,m){if(!c.id)throw new Error("No channel ID set");const y={connectionId:c.id,data:m,domain:"sanity/channels",from:n.id,id:Ce(),to:c.config.id,type:d};try{e==null||e.postMessage(y,{targetOrigin:"*"})}catch{throw new Error(`Failed to postMessage '${y.id}' on '${n.id}'`)}}function f(c,d,m,y=!0){const w=Ce();if(c.status==="connecting"||c.status==="reconnecting"||c.status==="disconnected")return void c.buffer.push({type:d,data:m});if(!c.id)throw new Error("No channel ID set");const v={connectionId:c.id,data:m,domain:"sanity/channels",from:n.id,id:w,to:c.config.id,type:d};if(y){const g=setTimeout(()=>{v.connectionId===c.id&&(window.removeEventListener("message",I,!1),d!=="channel/heartbeat"&&c.buffer.push({type:d,data:m}),l(c,"reconnecting"),console.warn(`Received no response to message '${v.type}' on client '${n.id}' (ID: '${v.id}').`))},Nr),I=b=>{var A;const{data:S}=b;S.type==="channel/response"&&((A=S.data)!=null&&A.responseTo)&&S.data.responseTo===v.id&&(window.removeEventListener("message",I,!1),clearTimeout(g))};window.addEventListener("message",I,!1)}try{e==null||e.postMessage(v,{targetOrigin:n.targetOrigin})}catch{throw new Error(`Failed to postMessage '${v.id}' on client '${n.id}'`)}}return window.addEventListener("message",u,!1),t.forEach(c=>{l(c,"connecting")}),{destroy:function(){t.forEach(c=>{["disconnected"].includes(c.status)||(f(c,"channel/disconnect",{id:c.id},!1),l(c,"disconnected"))}),window.removeEventListener("message",u,!1),t.forEach(c=>{p(c),i(c)})},send:function(c,d,m){(c?Array.isArray(c)?[...c]:[c]:t).forEach(y=>{const w=t.find(v=>v.config.id===y);if(!w)throw new Error("Invalid channel ID");f(w,d,m)})}}}const qr=/^([A-Za-z]+):([0-9]+)$/,Jr=/^([A-Za-z]+):([0-9]+),([0-9]+)$/,Xr=/^([A-Za-z]+):([a-z0-9]+)$/,jt={alt:"altKey",ctrl:"ctrlKey",mod:typeof window<"u"&&/Mac|iPod|iPhone|iPad/.test(window.navigator.platform)?"metaKey":"ctrlKey",shift:"shiftKey"};function Yr(n,e){return n.every(t=>jt[t]?e[jt[t]]:e.key===t.toUpperCase())}function St(n){return n.key==="Alt"}function Qt(n){var t;if(n===void 0)return;const e=(t=decodeURIComponent(n))==null?void 0:t.split(".");return e[0]==="drafts"&&e.shift(),e.join(".")}function Hr(n){if(n!==void 0)return Gt.toString(function(e){const t=[];for(const i of e.split(".")){const r=qr.exec(i);if(r){t.push(r[1],Number(r[2]));continue}const o=Jr.exec(i);if(o){t.push(o[1],[Number(o[2]),Number(o[3])]);continue}const u=Xr.exec(i);u?t.push(u[1],{_key:u[2]}):t.push(i)}return t}(decodeURIComponent(n)))}function it(n){const{children:e,message:t,onRetry:i,onContinueAnyway:r,...o}=n,u=s.jsx(se,{fontSize:1,mode:"ghost",onClick:i,text:"Retry"}),p=s.jsx(se,{fontSize:1,mode:"ghost",tone:"critical",onClick:r,text:"Continue anyway"});return s.jsx(de,{height:"fill",...o,children:s.jsx(G,{align:"center",height:"fill",justify:"center",children:s.jsx(An,{padding:4,sizing:"border",width:0,children:s.jsxs(me,{space:4,children:[s.jsxs(me,{space:3,children:[s.jsx(N,{size:1,weight:"semibold",children:"An error occured"}),s.jsx(N,{muted:!0,size:1,children:t})]}),e,i&&r?s.jsxs(Cn,{space:2,children:[u,p]}):i?s.jsx(ae,{children:u}):r?s.jsx(ae,{children:p}):null]})})})})}function Le(){const n=a.useContext($t);if(!n)throw new Error("Presentation context is missing");return n}function Qr(n){const e=["comment","inspect","instruction","pathKey","rev","since","template","view"];return function(t={}){const i=Object.entries(t).map(([r,o])=>`${r}=${o}`).join("&");return i.length?`?${i}`:""}(Object.entries(n).filter(([t])=>e.includes(t)).reduce((t,[i,r])=>r==null?t:{...t,[i]:r},{}))}const Zr=a.forwardRef(function(n,e){const{deskParams:t,params:i}=Le();return s.jsx(Ye,{...n,ref:e,state:{type:void 0,_searchParams:Object.entries({...t,preview:i.preview})},title:void 0})}),ei=a.forwardRef(function(n,e){const{documentId:t,documentType:i,parentRefPath:r,template:o,...u}=n;return s.jsx(Ye,{...u,ref:e,state:{id:t,type:i},title:void 0})});function Zt(n){const{children:e,params:t,onDeskParams:i,previewUrl:r,refs:o}=n,{state:u,resolvePathFromState:p}=Ut(),l=Tt(Object.fromEntries(u._searchParams||[])),h=a.useCallback(c=>`${p(u)}${Qr({...l,...c})}`,[p,l,u]),f=a.useMemo(()=>({index:0,groupIndex:0,siblingIndex:0,payload:{},params:t,hasGroupSiblings:!1,groupLength:1,routerPanesState:[],ChildLink:c=>{const{childId:d,...m}=c,y=o==null?void 0:o.find(w=>Nn(w._id)===d);return y?s.jsx(Ye,{...m,state:{id:y._id,type:y._type,_searchParams:Object.entries({preview:r})}}):s.jsx("div",{...m})},BackLink:Zr,ReferenceChildLink:ei,ParameterizedLink:()=>s.jsx(s.Fragment,{children:"ParameterizedLink"}),closeCurrentAndAfter:()=>{console.warn("closeCurrentAndAfter")},handleEditReference:c=>{console.warn("handleEditReference",c)},replaceCurrent:c=>{console.warn("replaceCurrent",c)},closeCurrent:()=>{console.warn("closeCurrent")},duplicateCurrent:c=>{console.warn("duplicateCurrent",c)},setView:c=>{console.warn("setView",c)},setParams:c=>{i({...c,inspect:c.inspect??void 0})},setPayload:c=>{console.warn("setPayload",c)},navigateIntent:(c,d,m)=>{console.warn("navigateIntent",c,d,m)},createPathWithParams:h}),[h,i,t,r,o]);return s.jsx(Bn.Provider,{value:f,children:e})}const ti=te(Ft)`
  height: 100%;
`,ni=te(G)`
  & > div {
    min-width: none !important;
    max-width: none !important;
  }
`,ri=te(Oe)`
  white-space: pre-wrap;
`;function ii(n){const{onDeskParams:e,previewUrl:t,refs:i}=n,{devMode:r}=Le(),o=a.useMemo(()=>({id:"$root",options:{filter:"_id in $ids",params:{ids:i.map(f=>f._id)}},schemaTypeName:"",title:"Documents on this page",type:"documentList"}),[i]),[u,p]=a.useState(null),l=a.useCallback(()=>p(null),[]),[h]=a.useState(()=>({}));return a.useEffect(()=>p(null),[i]),u?s.jsx(it,{flex:1,message:"Could not render the document list",onRetry:l,children:r&&s.jsx(de,{overflow:"auto",padding:3,radius:2,tone:"critical",children:s.jsxs(me,{space:3,children:[s.jsx(ze,{muted:!0,size:0,children:"Error message"}),s.jsx(ri,{size:1,children:u.error.message})]})})}):s.jsx(Vt,{onCatch:p,children:s.jsx(ti,{children:s.jsx(Lt,{children:s.jsx(Zt,{params:h,onDeskParams:e,previewUrl:t,refs:i,children:s.jsx(ni,{direction:"column",flex:1,children:s.jsx(Dn,{index:0,itemId:"$root",pane:o,paneKey:"$root"})})})})})})}function oi(n){const{onDeskParams:e,previewUrl:t,refs:i}=n,r=a.useMemo(()=>i.map(({_id:o,_type:u})=>({_id:Qt(o),_type:u})),[i]);return s.jsx(ii,{onDeskParams:e,previewUrl:t,refs:r})}const si=te(Oe)`
  white-space: pre-wrap;
`;function ai(n){const{documentId:e,documentType:t,params:i,onDeskParams:r,onFocusPath:o}=n,{devMode:u}=Le(),p=a.useMemo(()=>({id:e,options:{id:e,type:t},title:"",type:"document"}),[e,t]),[l,h]=a.useState(null),f=a.useCallback(()=>h(null),[]);a.useEffect(()=>{h(null)},[e,t,i]);const{setLayoutCollapsed:c}=Ln(),d=a.useCallback(()=>c(!0),[c]),m=a.useCallback(()=>c(!1),[c]);return l?s.jsx(it,{flex:1,message:"Could not render the document editor",onRetry:f,children:u&&s.jsx(de,{overflow:"auto",padding:3,radius:2,tone:"critical",children:s.jsxs(me,{space:3,children:[s.jsx(ze,{muted:!0,size:0,children:"Error message"}),s.jsx(si,{size:1,children:l.error.message})]})})}):s.jsx(Vt,{onCatch:h,children:s.jsx(Ft,{style:{height:"100%"},onExpand:m,onCollapse:d,children:s.jsx(Zt,{onDeskParams:r,params:i,children:s.jsx(Fn,{paneKey:"document",index:1,itemId:"document",pane:p,onFocusPath:o})})})})}function ci(n){const{deskParams:e,documentId:t,documentType:i,onDeskParams:r,onFocusPath:o}=n;return s.jsx(Lt,{children:s.jsx(ai,{documentId:t,documentType:i,params:e,onDeskParams:r,onFocusPath:o})})}function ui(n){const{deskParams:e,documentId:t,documentType:i,onDeskParams:r,onFocusPath:o,previewUrl:u,refs:p}=n;return t&&i?s.jsx(ci,{deskParams:e,documentId:t,documentType:i,onDeskParams:r,onFocusPath:o}):s.jsx(oi,{onDeskParams:r,previewUrl:u,refs:p})}function li(n){return document.addEventListener("visibilitychange",n),()=>document.removeEventListener("visibilitychange",n)}function di(n){const{liveDocument:e,channel:t,perspective:i,liveQueries:r,documentsOnPage:o}=n,[u]=a.useState(()=>new Ir(Rn)),p=_e({apiVersion:"2023-10-16"}),l=a.useMemo(()=>p.config(),[p]),h=a.useMemo(()=>p.withConfig({resultSourceMap:"withKeyArraySelector"}),[p]);a.useEffect(()=>{if(t){const{projectId:m,dataset:y}=l;t.send("loaders","loader/perspective",{projectId:m,dataset:y,perspective:i})}},[t,l,i]);const f=a.useMemo(()=>{const m=o.map(({_id:v})=>v),y=[...new Set(m)],w=u.capacity;return y.length>=w&&(y.length=w),y},[u.capacity,o]),[c,d]=a.useState(0);return s.jsxs(s.Fragment,{children:[s.jsx(pi,{cache:u,client:h,turboIds:f,setDocumentsCacheLastUpdated:d}),Object.entries(r).map(([m,{query:y,params:w,perspective:v}])=>s.jsx(hi,{cache:u,projectId:l.projectId,dataset:l.dataset,perspective:v,query:y,params:w,channel:t,client:h,refreshInterval:i?2e3:0,liveDocument:e,documentsCacheLastUpdated:c},`${m}${v}`))]})}const pi=a.memo(function(n){const{cache:e,client:t,turboIds:i,setDocumentsCacheLastUpdated:r}=n,[o,u]=a.useState([]);return a.useEffect(()=>{const p=new Set(o.flat()),l=new Set;for(const f of i)p.has(f)||e.has(f)||l.add(f);const h=[...l].slice(0,at);h.length!==0&&u(f=>[...f.slice(-at),h])},[o,e,i]),a.useEffect(()=>{const p=t.listen("*",{},{events:["mutation"],effectFormat:"mendoza",includePreviousRevision:!1,includeResult:!1,tag:"presentation-loader"}).subscribe(l=>{var f,c;if(l.type==="mutation"&&l.transition==="disappear"&&e.delete(l.documentId)&&r(Date.now()),l.type!=="mutation"||!((c=(f=l.effects)==null?void 0:f.apply)!=null&&c.length))return;const h=e.peek(l.documentId);if(h){const d={...h};delete d._rev;const m=pr(d,l.effects.apply);e.set(l.documentId,m),r(Date.now())}});return()=>p.unsubscribe()},[e,t,r]),s.jsx(s.Fragment,{children:o.map(p=>s.jsx(en,{cache:e,client:t,ids:p,setDocumentsCacheLastUpdated:r},JSON.stringify(p)))})}),en=a.memo(function(n){const{client:e,cache:t,ids:i,setDocumentsCacheLastUpdated:r}=n;return a.useEffect(()=>{const o=i.filter(u=>!t.has(u));o.length!==0&&e.getDocuments(o).then(u=>{for(const p of u)p&&(p!=null&&p._id)&&(t.set(p._id,p),r(Date.now()))},console.error)},[t,e,i,r]),null});function hi(n){const{cache:e,projectId:t,dataset:i,perspective:r,query:o,client:u,refreshInterval:p,liveDocument:l,channel:h,documentsCacheLastUpdated:f}=n,c=function(w){const v=a.useMemo(()=>JSON.stringify(w||{}),[w]);return a.useMemo(()=>JSON.parse(v),[v])}(n.params),d=function(w){const{cache:v,liveDocument:g,client:I,refreshInterval:b,query:S,params:A,perspective:k,documentsCacheLastUpdated:U}=w,[P,O]=a.useState(null),{projectId:E,dataset:z}=a.useMemo(()=>{const{projectId:q,dataset:R}=I.config();return{projectId:q,dataset:R}},[I]),[Y,le]=a.useState(null);if(Y)throw Y;const[X,pe]=function(q){const{refreshInterval:R}=q,T=function(){const[D,ee]=a.useState(!1);a.useEffect(()=>{ee(navigator.onLine);const ne=()=>ee(!0),H=()=>ee(!1);return window.addEventListener("online",ne),window.addEventListener("offline",H),()=>{window.removeEventListener("online",ne),window.removeEventListener("offline",H)}},[]);const F=a.useSyncExternalStore(li,()=>document.visibilityState,()=>"hidden");return!D||F==="hidden"}(),[B,W]=a.useState("hit"),$=a.useCallback(()=>(W("inflight"),()=>W("hit")),[]);return a.useEffect(()=>{if(!R||B!=="hit")return;const D=setTimeout(()=>W("stale"),R);return()=>clearTimeout(D)},[R,B]),a.useEffect(()=>{if(B!=="hit")return;const D=()=>W("stale");return window.addEventListener("focus",D),()=>window.removeEventListener("focus",D)},[R,B]),a.useEffect(()=>{T&&B==="hit"&&W("stale"),T||B!=="stale"||W("refresh")},[T,B]),[B,$]}({refreshInterval:b}),L=X==="refresh"||X==="inflight";return a.useEffect(()=>{if(!L)return;let q=!1,R=!1;const T=new AbortController;async function B(){const{signal:$}=T;R=!0;const{result:D,resultSourceMap:ee}=await I.fetch(S,A,{tag:"presentation-loader",signal:$,perspective:k,filterResponse:!1});R=!1,$.aborted||(O({result:D,resultSourceMap:ee}),q=!0)}const W=pe();return B().catch($=>{R=!1,$.name!=="AbortError"&&le($)}).finally(W),()=>{q||R||T.abort()}},[I,z,g,A,k,E,S,L,pe]),a.useMemo(()=>U&&(P!=null&&P.resultSourceMap)?{result:fi(v,g,P.result,k,P.resultSourceMap),resultSourceMap:P.resultSourceMap}:P,[v,U,g,k,P])}({cache:e,client:u,liveDocument:l,params:c,perspective:r,query:o,refreshInterval:p,documentsCacheLastUpdated:f}),m=d==null?void 0:d.result,y=d==null?void 0:d.resultSourceMap;return a.useEffect(()=>{y&&h.send("loaders","loader/query-change",{projectId:t,dataset:i,perspective:r,query:o,params:c,result:m,resultSourceMap:y})},[h,i,c,r,t,o,m,y]),null}en.displayName="GetDocuments";let kt=!1;function fi(n,e,t,i,r){if(i==="raw")throw new Error("turboChargeResultIfSourceMap does not support raw perspective");return or(t,r,o=>{if(!o._projectId)return e!=null&&e._id&&Me(e._id)===Me(o._id)?e:n.get(o._id);kt||(console.warn("Cross dataset references are not supported yet, ignoring source document",o),kt=!0)},(o,{previousValue:u})=>typeof o=="number"&&typeof u=="string"?`${o}`:o,i)}const Fe=a.createContext(null);Fe.displayName="PanelsContext";const mi=te.div`
  overflow: hidden;
  flex-basis: 0;
  flex-shrink: 1;
`,Je=function({children:n,defaultSize:e=null,id:t,minWidth:i,maxWidth:r,order:o=0}){const u=a.useContext(Fe);if(u===null)throw Error("Panel components must be rendered within a PanelGroup container");const{getPanelStyle:p,registerElement:l,unregisterElement:h}=u,f=p(t);return a.useLayoutEffect(()=>(l(t,{id:t,type:"panel",defaultSize:e,maxWidth:r??null,minWidth:i??0,order:o}),()=>{h(t)}),[t,e,o,r,i,l,h]),s.jsx(mi,{style:f,children:n})},yi=te.div`
  position: relative;
`,vi=te.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: -5px;
  width: 9px;
  z-index: 10;
  cursor: ${({$disabled:n})=>n?"auto":"ew-resize"};

  /* Border */
  & > span:nth-child(1) {
    display: block;
    border-left: 1px solid var(--card-border-color);
    position: absolute;
    top: 0;
    left: 4px;
    bottom: 0;
    transition: opacity 200ms;
  }

  ${({$disabled:n})=>!n&&`
    /* Hover effect */
    & > span:nth-child(2) {
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      width: 9px;
      bottom: 0;
      background-color: var(--card-border-color);
      opacity: 0;
      transition: opacity 150ms;
    }

    @media (hover: hover) {
      &:hover > span:nth-child(2) {
        opacity: 0.2;
      }
    }
  `}
`,tn=function({id:n,order:e,disabled:t=!1}){const i=a.useRef(null),r=a.useContext(Fe);if(r===null)throw Error("Panel components must be rendered within a PanelGroup container");const o=function(v){return a.useRef(v||Ce()).current}(n),{activeResizer:u,drag:p,startDragging:l,stopDragging:h,registerElement:f,unregisterElement:c}=r,d=u===o;if(r===null)throw Error("Panel components must be rendered within a PanelGroup container");const m=a.useCallback(v=>{l(o,v.nativeEvent)},[o,l]),y=a.useCallback(v=>{p(o,v)},[o,p]),w=a.useCallback(()=>{i.current.blur(),h()},[h]);return a.useEffect(()=>{if(d&&!t)return window.addEventListener("mousemove",y),window.addEventListener("mouseup",w),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",w)}},[t,d,y,w]),a.useLayoutEffect(()=>(f(o,{id:o,order:e,type:"resizer",el:i}),()=>{c(o)}),[o,e,f,c]),s.jsx(yi,{onMouseDown:m,ref:i,children:s.jsxs(vi,{$disabled:t,children:[s.jsx("span",{}),s.jsx("span",{})]})})};function nn(n,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>{n.apply(n,i)},e)}}const rn="presentation/panels",Pt=()=>JSON.parse(localStorage.getItem(rn)||"{}"),Et=n=>n.map(e=>[e.id,e.order].join(":")).join(",");function gi(){return a.useMemo(()=>{const n=(e,t)=>{(i=>{localStorage.setItem(rn,JSON.stringify(i))})({...Pt(),[Et(e)]:t})};return{get:e=>Pt()[Et(e)],set:n,setDebounced:nn(n,100)}},[])}function Xe(n,e,t){const{maxWidth:i,minWidth:r}=n,o=i==null?100:i/t*100,u=r/t*100;return Math.min(o,Math.max(u,e))}function wi(n,e,t){if(n.length===1)return"100";const i=t[n.findIndex(r=>r.id===e)];return i==null?"0":i.toPrecision(10)}function It(n,e,t=0,i=null){return n.clientX-(i||e.getBoundingClientRect()).left-t}function Ne(n){return n.type==="panel"}function At(n){return n.type==="resizer"}function Ct(n){return Array.from(n.values()).sort(({order:e},{order:t})=>e==null&&t==null?0:e==null?-1:t==null?1:e-t)}function Rt(n,e,t){const i=e.reduce((u,p)=>u+p,0),r=[...e].map(u=>u/i*100);let o=0;for(let u=0;u<n.length;u++){const p=n[u],l=r[u],h=Xe(p,l,t);l!=h&&(o+=l-h,r[u]=h)}if(o.toFixed(3)!=="0.000")for(let u=0;u<n.length;u++){const p=n[u];let{maxWidth:l,minWidth:h}=p;h=h/t*100,l!=null&&(l=l/t*100);const f=Math.min(l??100,Math.max(h,r[u]+o));if(f!==r[u]&&(o-=f-r[u],r[u]=f,Math.abs(o).toFixed(3)==="0.000"))break}return r}const bi=te.div`
  display: flex;
  flex-direction: row;
  height: 100%;
  overflow: hidden;
  width: 100%;
`,xi=function({children:n}){const e=a.useRef(null),[t,i]=a.useState(new Map),r=a.useMemo(()=>Ct(t).filter(Ne),[t]),[o,u]=a.useState([]),[p,l]=a.useState(null),h=a.useRef({elements:t,panels:r,widths:o}),f=a.useCallback(b=>({flexGrow:wi(r,b,o),pointerEvents:p===null?void 0:"none"}),[p,r,o]),c=a.useCallback((b,S)=>{i(A=>{if(A.has(b))return A;const k=new Map(A);return k.set(b,S),k})},[]),d=a.useCallback(b=>{i(S=>{if(!S.has(b))return S;const A=new Map(S);return A.delete(b),A})},[]),m=a.useRef({containerWidth:window.innerWidth,dragOffset:0,panelAfter:null,panelBefore:null,resizerIndex:-1,resizerRect:null,startX:0,widths:[]}),y=a.useCallback((b,S)=>{const A=Ct(t),k=A.findIndex(O=>O.id===b),U=t.get(b);if(!U||!At(U))return;const P=U.el.current;P&&(m.current={resizerIndex:k,panelBefore:A.reduce((O,E,z)=>Ne(E)&&z<k?E:O,null),panelAfter:A.reduce((O,E,z)=>O===null&&Ne(E)&&z>k?E:O,null),containerWidth:window.innerWidth,startX:S.pageX,dragOffset:It(S,P),resizerRect:P.getBoundingClientRect(),widths:h.current.widths},l(b))},[t]),w=a.useCallback(()=>{l(null)},[]),v=a.useCallback((b,S)=>{S.preventDefault(),S.stopPropagation();const{containerWidth:A,dragOffset:k,panelBefore:U,panelAfter:P,resizerRect:O}=m.current;if(U==null||P==null)return;const E=t.get(b);if(!E||!At(E))return;const z=E.el.current;if(!z)return;const Y=It(S,z,k,O);if(Y===0)return;const{widths:le}=h.current,X=function(L,q,R,T,B,W){const{panels:$,widths:D}=B,{widths:ee}=W,F=ee||D,ne=[...F];{const ie=L<0?T:R,Q=F[$.findIndex(C=>C.id===ie.id)],x=Xe(ie,Q+Math.abs(L),q);if(Q===x)return F;L=L<0?Q-x:x-Q}let H=0,ge=L<0?R:T,re=$.findIndex(ie=>ie.id===ge.id);for(;;){const ie=$[re],Q=F[re],x=Xe(ie,Q-(Math.abs(L)-Math.abs(H)),q);if(Q!==x&&(H+=Q-x,ne[re]=x,H.toPrecision(10).localeCompare(Math.abs(L).toPrecision(10),void 0,{numeric:!0})>=0))break;if(L<0){if(--re<0)break}else if(++re>=$.length)break}return H===0?F:(ge=L<0?T:R,re=$.findIndex(ie=>ie.id===ge.id),ne[re]=F[re]+H,ne)}(Y/e.current.getBoundingClientRect().width*100,A,U,P,h.current,m.current);le.some((L,q)=>L!==X[q])&&u(X)},[t]);a.useLayoutEffect(()=>{h.current.elements=t,h.current.panels=r,h.current.widths=o},[t,r,o]);const g=gi();a.useLayoutEffect(()=>{const{widths:b}=h.current;if(b.length===r.length)return;const S=g.get(r);if(S){const k=Rt(r,S,window.innerWidth);return void u(k)}const A=function(k){let U=k.length,P=100;const O=k.map(z=>z.defaultSize?(P-=z.defaultSize,U-=1,z.defaultSize):null),E=P/U;return O.map(z=>z===null?E:z)}(r);u(A)},[g,r]),a.useEffect(()=>{o.length&&g.setDebounced(r,o)},[g,r,o]),a.useLayoutEffect(()=>{const b=new ResizeObserver(()=>{const{panels:S,widths:A}=h.current,k=Rt(S,A,window.innerWidth);A.some((P,O)=>P!==k[O])&&u(k)});return b.observe(e.current),()=>{b.disconnect()}},[]);const I=a.useMemo(()=>({activeResizer:p,drag:v,getPanelStyle:f,registerElement:c,startDragging:y,stopDragging:w,unregisterElement:d}),[p,v,f,c,y,w,d]);return s.jsx(Fe.Provider,{value:I,children:s.jsx(bi,{ref:e,children:n})})},ji=function(n){const{children:e,navigate:t}=n,i=a.useCallback((r,o=void 0)=>{t(o||{},r?{preview:r}:{})},[t]);return s.jsx(zn.Provider,{value:i,children:e})};function Si(n){const{unstable_navigator:e}=n,t=!!(e!=null&&e.component),[i,r]=function(l,h){const[f,c]=a.useState(()=>JSON.parse(localStorage.getItem(l)??JSON.stringify(h)));return a.useEffect(()=>{localStorage.setItem(l,JSON.stringify(f))},[l,f]),[f,c]}("presentation/navigator",t),o=!!t&&i,u=a.useMemo(()=>{if(t)return()=>r(l=>!l)},[t,r]),p=a.useCallback(function(){return s.jsx(s.Fragment,{children:o&&s.jsx(ki,{...e})})},[o,e]);return[{navigatorEnabled:o,toggleNavigator:u},p]}const ki=a.memo(function(n){const{minWidth:e,maxWidth:t,component:i}=n,r=e!=null&&t!=null&&e===t;return s.jsxs(s.Fragment,{children:[s.jsx(Je,{id:"navigator",minWidth:e,maxWidth:t,order:1,children:s.jsx(i,{})}),s.jsx(tn,{order:2,disabled:r})]})}),Pi=function(n){const{children:e,params:t}=n,i=a.useMemo(()=>t,[t]);return s.jsx(On.Provider,{value:i,children:e})},Ei=function(n){const{children:e,deskParams:t,devMode:i,name:r,navigate:o,params:u}=n,p=a.useMemo(()=>({deskParams:t,devMode:i,name:r,navigate:o,params:u}),[t,i,r,o,u]);return s.jsx($t.Provider,{value:p,children:e})},Ii=Mt(te.iframe`
  border: 0;
  max-height: 100%;
  width: 100%;
  display: block;
`),Ai=function(n){var v;const{basePath:e="/"}=((v=Dt())==null?void 0:v.activeWorkspace)||{},{fontSize:t=1,onChange:i,origin:r,padding:o=3,value:u}=n,p=a.useRef(null),[l,h]=a.useState(void 0),[f,c]=a.useState(void 0),d=a.useCallback(g=>{h(g.currentTarget.value)},[]),m=a.useCallback(g=>{var I;if(g.key==="Enter"){if(l===void 0)return;const b=l.startsWith("/")||l===""?`${r}${l}`:l;if(!b.startsWith(r+"/")&&b!==r)return void c(`URL must start with ${r}`);if(!r&&(b.startsWith(`${e}/`)||b===e))return void c(`URL can't have the same base path as the Studio ${e}`);const S=b===r?r+"/":b;c(void 0),h(void 0),i(S.slice(r.length)),(I=p.current)==null||I.blur()}g.key==="Escape"&&(c(void 0),h(void 0))},[e,i,r,l]),y=a.useCallback(()=>{c(void 0),h(void 0)},[]);a.useEffect(()=>{c(void 0),h(void 0)},[r,u]);const w=a.useMemo(()=>({icon:_n}),[]);return s.jsx(s.Fragment,{children:s.jsx(Mn,{clearButton:f?w:void 0,customValidity:f,fontSize:t,onBlur:y,onClear:()=>{c(void 0),h(r+u)},onChange:d,onKeyDownCapture:m,padding:o,style:{zIndex:1},radius:2,ref:p,space:o,value:l===void 0?`${r}${u}`:l})})},Be=Mt(G),Ci=te(Vn)`
  & > span {
    width: 21px;
    height: 13px;
    overflow: hidden;

    & > span:nth-child(1) {
      width: 21px;
      height: 13px;
    }

    & > span:nth-child(2) {
      width: 9px;
      height: 9px;
      top: 2px;
      left: 2px;
    }
  }

  & input:checked + span {
    & > span:nth-child(2) {
      transform: translate3d(8px, 0, 0) !important;
    }
  }
`,We={previewDrafts:"Drafts",published:"Published",raw:"Raw"},Ri="caution",zi="positive",zt={previewDrafts:Un,published:Tn,raw:$n},Oi=a.forwardRef(function(n,e){const{initialUrl:t,targetOrigin:i,navigatorEnabled:r,onPathChange:o,openPopup:u,overlayEnabled:p,params:l,perspective:h,setPerspective:f,toggleNavigator:c,toggleOverlay:d,loadersConnection:m,overlaysConnection:y,previewKitConnection:w}=n,{devMode:v}=Le(),[g,I]=a.useState("desktop"),b=dn(),S=a.useCallback(()=>I("desktop"),[I]),A=a.useCallback(()=>I("mobile"),[I]),[k,U]=a.useState(!0),[P,O]=a.useState(!1),[E,z]=a.useState(!1),[Y,le]=a.useState(!1),X=k||E||y==="connecting",pe=a.useMemo(()=>i===location.origin?"":i,[i]),L=a.useCallback(()=>{typeof e!="function"&&(e!=null&&e.current)&&(e.current.src=`${i}${l.preview||"/"}`,z(!0))},[l.preview,i,e]),q=a.useCallback(()=>{typeof e!="function"&&(e!=null&&e.current)&&(e.current.src=t.toString(),z(!0))},[e,t]),R=a.useCallback(()=>{B(!0)},[]),[T,B]=a.useState(!1),[W,$]=a.useState(!1);a.useEffect(()=>{if(!(k||E||y!=="connecting"&&y!=="reconnecting")){const F=setTimeout(()=>{$(!0)},1e3);return()=>clearTimeout(F)}},[y,k,E,$]),a.useEffect(()=>{if(!k&&!E&&W){if(y==="connected"&&(le(!1),$(!1),O(!1),B(!1)),y==="connecting"){const F=setTimeout(()=>{O(!0),console.error("Unable to connect to overlays. Make sure you're calling the 'enableOverlays' function in '@sanity/overlays' correctly")},ct);return()=>clearTimeout(F)}if(y==="reconnecting"){const F=setTimeout(()=>{O(!0),le(!0)},ct);return()=>clearTimeout(F)}y==="disconnected"&&le(!0)}},[k,y,E,W]);const D=a.useMemo(()=>{const F=new URL(l.preview||"/",i),{pathname:ne,search:H}=_r(F);return`${ne}${H}`},[l.preview,i]),ee=a.useCallback(()=>{U(!1),z(!1)},[]);return s.jsx(Gn,{transition:b?{duration:0}:void 0,children:s.jsxs(pn,{delay:1e3,children:[s.jsx(de,{flex:"none",padding:2,shadow:1,style:{position:"relative"},children:s.jsxs(G,{align:"center",gap:2,style:{minHeight:0},children:[c&&s.jsx(je,{animate:!0,content:s.jsx(N,{size:1,children:"Toggle navigator"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:s.jsx(se,{"aria-label":"Toggle navigator",fontSize:1,icon:hn,mode:"bleed",onClick:c,padding:3,selected:r})}),s.jsx(je,{animate:!0,content:s.jsxs(G,{align:"center",style:{whiteSpace:"nowrap"},children:[s.jsx(ae,{padding:1,children:s.jsx(N,{size:1,children:p?"Disable edit overlay":"Enable edit overlay"})}),s.jsx(ae,{paddingY:1,children:s.jsx(fn,{keys:["Alt"],style:{marginTop:-4,marginBottom:-4}})})]}),fallbackPlacements:["bottom-start"],padding:1,placement:"bottom",portal:!0,children:s.jsx(de,{as:"label",flex:"none",padding:3,style:{lineHeight:0,borderRadius:999,userSelect:"none"},tone:p?"positive":void 0,children:s.jsxs(G,{align:"center",gap:2,children:[s.jsx("div",{style:{margin:-2},children:s.jsx(Ci,{checked:p,onChange:d,disabled:X})}),s.jsx(ae,{children:s.jsx(N,{muted:!0,size:1,weight:"medium",children:"Edit"})})]})})}),v&&s.jsx(je,{animate:!0,content:s.jsx(N,{size:1,children:E?"Refreshing":"Refresh preview"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:s.jsx(se,{"aria-label":"Refresh preview",fontSize:1,icon:mn,mode:"bleed",loading:E,onClick:L,padding:3})}),s.jsx(ae,{flex:1,children:s.jsx(Ai,{onChange:o,origin:pe,value:D})}),s.jsx(G,{align:"center",flex:"none",gap:1,children:s.jsx(ut,{button:s.jsx(se,{fontSize:1,iconRight:yn,mode:"bleed",padding:3,space:2}),id:"location-menu",menu:s.jsx(lt,{children:s.jsx(Ui,{initialUrl:t,openPopup:u,previewLocationOrigin:pe,previewLocationRoute:D})}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),s.jsx(G,{align:"center",flex:"none",gap:1,children:s.jsx(ut,{button:s.jsx(se,{fontSize:1,iconRight:vn,mode:"bleed",padding:3,space:2,text:We[h],loading:X||m==="connecting"&&w!=="connected",disabled:m!=="connected"}),id:"perspective-menu",menu:s.jsxs(lt,{style:{maxWidth:240},children:[s.jsx(Re,{fontSize:1,onClick:()=>f("previewDrafts"),padding:3,pressed:h==="previewDrafts",tone:Ri,children:s.jsxs(G,{align:"flex-start",gap:3,children:[s.jsx(ae,{flex:"none",children:s.jsx(N,{size:1,children:a.createElement(zt.previewDrafts)})}),s.jsxs(me,{flex:1,space:2,children:[s.jsx(N,{size:1,weight:"medium",children:We.previewDrafts}),s.jsx(N,{muted:!0,size:1,children:"View this page with latest draft content"})]}),s.jsx(ae,{flex:"none",children:s.jsx(N,{muted:!0,size:1,style:{opacity:h==="previewDrafts"?1:0},children:s.jsx(dt,{})})})]})}),s.jsx(Re,{fontSize:1,onClick:()=>f("published"),padding:3,pressed:h==="published",tone:zi,children:s.jsxs(G,{align:"flex-start",gap:3,children:[s.jsx(ae,{flex:"none",children:s.jsx(N,{size:1,children:a.createElement(zt.published)})}),s.jsxs(me,{flex:1,space:2,children:[s.jsx(N,{size:1,weight:"medium",children:We.published}),s.jsx(N,{muted:!0,size:1,children:"View this page with published content"})]}),s.jsx(ae,{flex:"none",children:s.jsx(N,{muted:!0,size:1,style:{opacity:h==="published"?1:0},children:s.jsx(dt,{})})})]})})]}),popover:{animate:!0,constrainSize:!0,placement:"bottom",portal:!0}})}),s.jsxs(G,{align:"center",flex:"none",gap:1,children:[s.jsx(je,{animate:!0,content:s.jsx(N,{size:1,children:"Full viewport"}),fallbackPlacements:["bottom-start"],padding:2,placement:"bottom",portal:!0,children:s.jsx(se,{"aria-label":"Full viewport",fontSize:1,icon:gn,mode:"bleed",onClick:S,padding:3,selected:g==="desktop"})}),s.jsx(je,{animate:!0,content:s.jsx(N,{size:1,children:"Narrow viewport"}),padding:2,placement:"bottom",portal:!0,children:s.jsx(se,{"aria-label":"Narrow viewport",fontSize:1,icon:wn,mode:"bleed",onClick:A,padding:3,selected:g==="mobile"})})]})]})}),s.jsx(de,{flex:1,tone:"transparent",children:s.jsxs(G,{align:"center",height:"fill",justify:"center",padding:g==="desktop"?0:2,sizing:"border",style:{position:"relative",cursor:X?"wait":void 0},children:[s.jsx(bn,{children:Y||k||E||!W||T?!k&&!X||T?Y&&!T?s.jsx(Be,{initial:"initial",animate:"animate",exit:"exit",variants:_i,justify:"center",align:"center",style:{background:"var(--card-bg-color)",inset:"0",position:"absolute",borderTop:"1px solid transparent",boxShadow:"0 0 0 1px var(--card-border-color)"},children:s.jsx(it,{flex:1,message:"Could not connect to the preview",onRetry:q,onContinueAnyway:R,children:v&&s.jsxs(s.Fragment,{children:[y!=="connected"&&s.jsx(de,{padding:3,radius:2,tone:"critical",children:s.jsxs(me,{space:3,children:[s.jsx(ze,{muted:!0,size:0,children:"Overlay connection status"}),s.jsx(Oe,{size:1,children:y})]})}),m!=="connected"&&s.jsx(de,{padding:3,radius:2,tone:"critical",children:s.jsxs(me,{space:3,children:[s.jsx(ze,{muted:!0,size:0,children:"Loader connection status"}),s.jsx(Oe,{size:1,children:m})]})})]})})}):null:s.jsx(Be,{initial:"initial",animate:"animate",exit:"exit",variants:Ot,justify:"center",align:"center",style:{inset:"0",position:"absolute"},children:s.jsxs(G,{style:{...Ue[g]},justify:"center",align:"center",direction:"column",gap:4,children:[s.jsx(pt,{muted:!0}),s.jsx(N,{muted:!0,size:1,children:"Loading"})]})}):s.jsx(Be,{initial:"initial",animate:"animate",exit:"exit",variants:Ot,justify:"center",align:"center",style:{inset:"0",position:"absolute",backdropFilter:P?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",transition:"backdrop-filter 0.2s ease-in-out",WebkitBackdropFilter:P?"blur(16px) saturate(0.5) grayscale(0.5)":"blur(2px)",WebkitTransition:"-webkit-backdrop-filter 0.2s ease-in-out",zIndex:1},children:s.jsxs(G,{style:{...Ue[g]},justify:"center",align:"center",direction:"column",gap:4,children:[P&&s.jsx(se,{disabled:!0,fontSize:1,mode:"ghost",text:"Continue anyway",style:{opacity:0}}),s.jsx(de,{radius:2,tone:P?"caution":"inherit",padding:4,shadow:1,children:s.jsxs(G,{justify:"center",align:"center",direction:"column",gap:4,children:[s.jsx(pt,{muted:!0}),s.jsx(N,{muted:!0,size:1,children:P?s.jsx(s.Fragment,{children:"Unable to connect, check the browser console for more information."}):"Connecting"})]})}),P&&s.jsx(se,{fontSize:1,tone:"critical",onClick:R,text:"Continue anyway"})]})})}),s.jsx(Ii,{ref:e,style:{pointerEvents:X&&!T?"none":"auto",boxShadow:"0 0 0 1px var(--card-border-color)",borderTop:"1px solid transparent"},src:t.toString(),initial:["background"],variants:Mi,animate:[!k&&!X||T?"active":"background",E?"reloading":"idle",g,W&&!T?"timedOut":""],onLoad:ee})]})})]})})}),Ue={desktop:{width:"100%",height:"100%"},mobile:{width:375,height:650}},Ot={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},_i={initial:{opacity:1},animate:{opacity:[0,0,1]},exit:{opacity:[1,0,0]}},Mi={desktop:{...Ue.desktop,boxShadow:"0 0 0 0px var(--card-border-color)"},mobile:{...Ue.mobile,boxShadow:"0 0 0 1px var(--card-border-color)"},background:{opacity:0,scale:1},idle:{scale:1},reloading:{scale:[1,1,1,.98]},active:{opacity:[0,0,1],scale:1},timedOut:{opacity:[0,0,1]}};function Ui(n){const{initialUrl:e,openPopup:t,previewLocationOrigin:i,previewLocationRoute:r}=n,o=a.useCallback(u=>{u.preventDefault(),t(u.currentTarget.href)},[t]);return s.jsxs(s.Fragment,{children:[s.jsx(Ti,{initialUrl:e,previewLocationOrigin:i,previewLocationRoute:r}),s.jsx(Re,{icon:xn,text:"Open preview",as:"a",href:`${i}${r}`,onClick:o,rel:"opener",target:"_blank"})]})}function Ti(n){const{initialUrl:e,previewLocationOrigin:t,previewLocationRoute:i}=n,{push:r}=jn(),o=_e({apiVersion:qe}),u=Ge(),[p,l]=a.useState(!1);return s.jsx(Re,{disabled:p,onClick:()=>{if(!(navigator!=null&&navigator.clipboard))return r({closable:!0,status:"error",title:"Clipboard not supported"}),!1;let h;l(!0);let f=`${t}${i}`;const c=()=>{r({id:h,closable:!0,status:"success",title:"The URL is copied to the clipboard"}),l(!1)},d=m=>{r({closable:!0,status:"error",title:"Copy failed",description:m.message||m.toString()}),l(!1)};if(Mr(e)&&typeof ClipboardItem<"u"){const m="text/plain",y=new ClipboardItem({[m]:(async()=>{h=r({closable:!0,title:"Copying URL to clipboard"});const w=await Ht(o,"@sanity/presentation",typeof window>"u"?"":location.href,u==null?void 0:u.id);return f=Ur(e,w.secret,i).toString(),new Blob([f],{type:m})})()});navigator.clipboard.write([y]).then(c).catch(d)}else navigator.clipboard.writeText(f).then(c).catch(d)},text:"Copy link",icon:Sn})}let _t=!1;function Ke(n){return Object.fromEntries(Object.entries(n).filter(([,e])=>e!==void 0&&e!==""&&e!==null))}function $i({initialPreviewUrl:n,routerNavigate:e,routerState:t,routerSearchParams:i,previewRef:r}){const o=a.useMemo(()=>{const{id:l,path:h,type:f}={id:Qt((c=t).id),path:Hr(c.path),type:c.type};var c;return{id:l,type:f,path:h,preview:i.preview||`${n.pathname}${n.search}`,perspective:i.perspective,inspect:i.inspect,rev:i.rev,since:i.since,template:i.template,view:i.view,pathKey:i.pathKey,instruction:i.instruction,comment:i.comment}},[t,i,n]),u=a.useMemo(()=>Ke({inspect:o.inspect,path:o.path,rev:o.rev,since:o.since,template:o.template,view:o.view,pathKey:o.pathKey,instruction:o.instruction,comment:o.comment}),[o.inspect,o.path,o.rev,o.since,o.template,o.view,o.pathKey,o.instruction,o.comment]),p=a.useRef(t);return a.useEffect(()=>{p.current=t},[t]),{deskParams:u,navigate:a.useMemo(()=>nn((l,h={},f)=>{const{_searchParams:c,...d}=p.current,m=(c||[]).reduce((g,[I,b])=>(g[I]=b,g),{}),y=Ke({...d,...l}),w=Ke({...m,...h});y._searchParams=Object.entries(w).reduce((g,[I,b])=>[...g,[I,b]],[]);const v=f??w.preview===r.current;e(y,{replace:v})},50),[e,r]),params:o}}function Di(n,e,t){var l,h;const i=_e({apiVersion:qe}),r=Dt(),o=((l=r==null?void 0:r.activeWorkspace)==null?void 0:l.basePath)||"/",u=function(f,c,d){const m=Ge();return a.useMemo(()=>["@sanity/presentation",c,d,f,m==null?void 0:m.id,Li],[c,m==null?void 0:m.id,f,d])}(e,o,((h=r==null?void 0:r.activeWorkspace)==null?void 0:h.name)||"default"),p=function(f,c){const d=_e({apiVersion:qe}),m=Ge(),[y,w]=a.useState(""),v=f?gt(async()=>await Ht(d,"@sanity/presentation",typeof window>"u"?"":location.href,m==null?void 0:m.id),[...c,y]):null;return a.useEffect(()=>{if(!v)return;const g=setTimeout(()=>{a.startTransition(()=>w(v.expiresAt.toString()))},v.expiresAt.getTime()-Date.now());return()=>clearTimeout(g)},[v]),(v==null?void 0:v.secret)||null}(typeof n=="object"||typeof n=="function",u);return gt(async()=>{if(typeof n=="string"){const d=new URL(n,location.origin);let m=d;try{if(t){const y=new URL(t,d);y.origin===d.origin&&(m=y)}else if(document.referrer){const y=new URL(document.referrer);y.origin===d.origin&&(m=y)}}catch{}return location.origin!==m.origin||!m.pathname.startsWith(`${o}/`)&&m.pathname!==o?m:d}const f=typeof n=="object"?Tr(n):n,c=await f({client:i,previewUrlSecret:p,previewSearchParam:t,referrer:typeof document>"u"?null:document.referrer,studioBasePath:o});return new URL(c,location.origin)},[...u,p])}const Li=Symbol(),Fi=te(G)`
  overflow-x: auto;
`;function Wi(n){const{previewUrl:e,components:t}=n.tool.options??{},i=n.tool.name||kn,{unstable_navigator:r}=t||{},{navigate:o,state:u}=Ut(),p=Tt(Object.fromEntries(u._searchParams||[])),l=Di(e||"/",i,p.preview||null),[h]=a.useState(()=>{var C;const x=(C=n.tool.options)==null?void 0:C.devMode;return typeof x=="function"?x():typeof x=="boolean"?x:typeof window<"u"&&window.location.hostname==="localhost"}),f=a.useMemo(()=>l.origin,[l.origin]),c=a.useRef(null),[d,m]=a.useState(),[y,w]=a.useState({}),v=a.useRef(),{params:g,deskParams:I,navigate:b}=$i({initialPreviewUrl:l,routerNavigate:o,routerState:u,routerSearchParams:p,previewRef:v}),[S,A]=a.useState(()=>g.perspective==="published"?g.perspective:"previewDrafts"),[k,U]=function(x){if(x!=="published"&&x!=="previewDrafts")throw new Error(`Invalid perspective: ${x}`);const[C,J]=a.useState({}),[V,j]=a.useState({}),Z=a.useCallback((he,oe)=>{const ke=oe.filter(_=>"_projectId"in _&&_._projectId?(_t||(console.warn("Cross dataset references are not supported yet, ignoring source document",_),_t=!0),!1):_);(he==="published"?J:j)(_=>{const fe={};for(const ye of ke)fe[ye._id]=ye;return Wn(_,fe)?_:fe})},[]);return[a.useMemo(()=>x==="published"?[...Object.values(C)]:[...Object.values(V)],[x,V,C]),Z]}(S),[P,O]=a.useState(!0),E=Pn(),z=En();a.useEffect(()=>{S!==g.perspective&&b({},{perspective:S==="published"?"published":void 0})},[g.perspective,S,b]);const[Y,le]=a.useState("connecting"),[X,pe]=a.useState("connecting"),[L,q]=a.useState("connecting"),[R]=a.useState(()=>new Set),T=a.useCallback(x=>{const C=window.open(x,"_blank");C&&R.add(C)},[R]);a.useEffect(()=>{if(R.size&&d)for(const x of R)x&&"closed"in x&&!x.closed&&d.addSource(x)},[d,R,R.size]),a.useEffect(()=>{var J;const x=(J=c.current)==null?void 0:J.contentWindow;if(!x)return;const C=function(V){const{destroy:j,send:Z}=xt(V),he=new Set,oe=new WeakMap,ke=new Set;return{destroy:()=>{j();for(const _ of ke)_()},send:(_,fe,ye)=>{Z(_,fe,ye);for(const ve of he)ve&&"closed"in ve&&!ve.closed&&oe.has(ve)&&oe.get(ve)(_,fe,ye)},addSource(_){if(he.has(_))return;if(!("closed"in _))throw console.warn("Source is unsupported",{source:_}),new Error("Source is unsupported");if(_.closed)throw new Error("Source is closed");const{send:fe,destroy:ye}=xt({...V,target:_,connectTo:V.connectTo.map(ve=>{const{onStatusUpdate:Vi,onEvent:ot,...on}=ve;return{...on,onEvent:ot?(Pe,sn)=>{if(Pe!=="preview-kit/documents"&&Pe!=="overlay/navigate"&&Pe!=="loader/documents")return ot(Pe,sn)}:void 0}})});ke.add(ye),oe.set(_,fe),he.add(_)}}}({id:"presentation",target:x,targetOrigin:f,connectTo:[{id:"overlays",heartbeat:!0,onStatusUpdate:le,onEvent(V,j){if(V==="overlay/focus"&&"id"in j)b({type:j.type,id:j.id,path:j.path});else if(V==="overlay/navigate"){if(v.current!==j.url){const Z=v.current===void 0;v.current=j.url,b(Z?{}:{id:void 0,type:void 0},{preview:j.url})}}else V==="overlay/toggle"&&O(j.enabled)}},{id:"loaders",heartbeat:!0,onStatusUpdate:pe,onEvent(V,j){if(V==="loader/documents"&&j.projectId===E&&j.dataset===z)U(j.perspective,j.documents);else if(V==="loader/query-listen"&&j.projectId===E&&j.dataset===z){if(typeof j.heartbeat=="number"&&j.heartbeat<Ve)throw new Error(`Loader query listen heartbeat interval must be at least ${Ve}ms`);w(Z=>{return{...Z,[(he=j.query,oe=j.params,`${he}-${typeof oe=="string"?oe:JSON.stringify(oe)}`)]:{perspective:j.perspective,query:j.query,params:j.params,receivedAt:Date.now(),heartbeat:j.heartbeat??!1}};var he,oe})}}},{id:"preview-kit",heartbeat:!0,onStatusUpdate:q,onEvent(V,j){V==="preview-kit/documents"&&j.projectId===E&&j.dataset===z&&U(j.perspective,j.documents)}}]});return m(C),()=>{C.destroy(),m(void 0)}},[z,E,U,b,f]),a.useEffect(()=>{const x=setInterval(()=>a.startTransition(()=>w(C=>{if(Object.keys(C).length<1)return C;const J=Date.now();if(!Object.values(C).some(j=>j.heartbeat!==!1&&J>j.receivedAt+j.heartbeat))return C;const V={};for(const[j,Z]of Object.entries(C))Z.heartbeat!==!1&&J>Z.receivedAt+Z.heartbeat||(V[j]=Z);return V})),Ve);return()=>clearInterval(x)},[]);const B=a.useCallback(x=>{b({path:Gt.toString(x)},{},!0)},[b]),W=a.useCallback(x=>{const C=new URL(x,l.origin),J=C.pathname+C.search;C.origin===l.origin&&J!==g.preview&&b({id:void 0,path:void 0},{preview:J})},[l,g,b]),$=a.useCallback(x=>{b({},x)},[b]);a.useEffect(()=>{g.id&&g.path?d==null||d.send("overlays","presentation/focus",{id:g.id,path:g.path}):d==null||d.send("overlays","presentation/blur",void 0)},[d,g.id,g.path]),a.useEffect(()=>{v.current&&g.preview&&v.current!==g.preview&&(v.current=g.preview,Y!=="connected"&&c.current?c.current.src=`${f}${g.preview}`:d==null||d.send("overlays","presentation/navigate",{url:g.preview,type:"replace"}))},[d,Y,f,g.preview]);const D=a.useCallback(()=>d==null?void 0:d.send("overlays","presentation/toggleOverlay",void 0),[d]),[ee,F]=a.useState(null);a.useEffect(()=>{const x=J=>{St(J)&&D()},C=J=>{St(J)&&D(),Yr(["mod","\\"],J)&&D()};return window.addEventListener("keydown",C),window.addEventListener("keyup",x),()=>{window.removeEventListener("keydown",C),window.removeEventListener("keyup",x)}},[D]);const[ne,H]=a.useState(null),[{navigatorEnabled:ge,toggleNavigator:re},ie]=Si({unstable_navigator:r}),Q=a.useRef(g.id);return a.useEffect(()=>{g.rev&&Q.current&&g.id!==Q.current&&b({},{rev:void 0}),Q.current=g.id}),s.jsxs(s.Fragment,{children:[s.jsx(Ei,{deskParams:I,devMode:h,name:i,params:g,navigate:b,children:s.jsx(ji,{navigate:b,children:s.jsx(Pi,{params:g,children:s.jsx(Fi,{height:"fill",children:s.jsxs(xi,{children:[s.jsx(ie,{}),s.jsx(Je,{id:"preview",minWidth:325,defaultSize:ge?50:75,order:3,children:s.jsx(G,{direction:"column",flex:1,height:"fill",ref:H,children:s.jsx(In,{element:ne,children:s.jsx(Oi,{initialUrl:l,navigatorEnabled:ge,onPathChange:W,openPopup:T,overlayEnabled:P,params:g,perspective:S,ref:c,setPerspective:A,targetOrigin:f,toggleNavigator:re,toggleOverlay:D,loadersConnection:X,overlaysConnection:Y,previewKitConnection:L})})})}),s.jsx(tn,{order:4}),s.jsx(Je,{id:"content",minWidth:325,order:5,children:s.jsx(Kn,{documentId:g.id,setDisplayedDocument:F,children:s.jsx(ui,{refs:k,deskParams:I,documentId:g.id,documentType:g.type,onDeskParams:$,onFocusPath:B,previewUrl:g.preview})})})]})})})})}),d&&s.jsx(di,{channel:d,liveQueries:y,perspective:S,liveDocument:ee,documentsOnPage:k})]})}export{Wi as default};
